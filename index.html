<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>é‚£äº›æ²¡è¯´å‡ºå£çš„ OS</title>
    <style>
        :root {
            --bg-start: #fdfaf5;
            --bg-end: #f2ede4;
            --text-main: #4a4a4a;
            --accent-soft: #b5ada0;
            --her-bubble: #e9f2e9; 
            --me-bubble: #ffffff;    
            --os-bg: #fffcf9;
            --os-border: #e6ddd0;
            --heart-red: #ff8e8e;
            --shadow: rgba(0, 0, 0, 0.04);
            --transition-bg: #1a1a1a;
        }

        body.dark-mode {
            --bg-start: #2c2c34; --bg-end: #1e1e24; --text-main: #d1d1d1;
            --accent-soft: #8a8a95; --her-bubble: #3d4a3d; --me-bubble: #454550;
            --os-bg: #25252b; --os-border: #444450;
        }

        body {
            background: linear-gradient(135deg, var(--bg-start), var(--bg-end));
            font-family: -apple-system, "HarmonyOS Sans SC", "STHeiti", sans-serif;
            color: var(--text-main);
            margin: 0;
            display: flex;
            justify-content: center;
            min-height: 100vh;
            touch-action: manipulation;
            transition: background 1s ease;
        }

        body::before {
            content: ""; position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAQAAAAECAYAAACp8Z5+AAAAAXNSR0IArs4c6QAAACZJREFUGF5jYGBgYGBgYOBiYGBgZGBgYGBgYGBgYGBgYGBgYGBgYACvAgQB9X82iAAAAABJRU5ErkJggg==');
            opacity: 0.05; pointer-events: none; z-index: 1000;
        }

        #app { width: 100%; max-width: 480px; padding: 40px 24px; box-sizing: border-box; display: flex; flex-direction: column; position: relative; z-index: 10; }

        /* å°é¢æ ·å¼ */
        #cover-page {
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            height: 80vh; text-align: center; animation: fadeIn 1.5s ease;
        }
        .pixel-mail {
            width: 60px; height: 40px; background: #d15d5d; position: relative; margin-bottom: 30px;
            box-shadow: 4px 4px 0 #4a2c10;
        }
        .pixel-mail::after {
            content: ""; position: absolute; top: 0; left: 0; width: 0; height: 0;
            border-left: 30px solid transparent; border-right: 30px solid transparent;
            border-top: 20px solid #f2ede4; opacity: 0.8;
        }
        .cover-title { font-size: 1.8rem; font-weight: 600; margin: 10px 0; color: #333; letter-spacing: 1px; }
        .cover-subtitle { font-size: 0.85rem; color: var(--accent-soft); letter-spacing: 2px; }
        .start-btn {
            margin-top: 50px; background: white; border: 1.5px solid var(--os-border);
            padding: 12px 30px; border-radius: 30px; color: var(--text-main);
            font-size: 0.9rem; cursor: pointer; box-shadow: 0 4px 10px var(--shadow);
        }

        /* ç”µå½±è½¬åœº */
        #transition-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: var(--transition-bg);
            display: none; justify-content: center; align-items: center; z-index: 2000;
            color: white; font-size: 1.1rem; letter-spacing: 2px; text-align: center;
        }

        .header-meta { display: flex; justify-content: space-between; font-size: 0.7rem; color: var(--accent-soft); margin-bottom: 15px; }
        .progress-bar-wrap { height: 2px; background: rgba(0,0,0,0.05); width: 100%; margin-bottom: 35px; }
        #progress-inner { height: 100%; background: var(--heart-red); width: 0%; transition: width 0.4s ease; }

        .scene-title { font-size: 1.15rem; text-align: center; margin-bottom: 8px; font-weight: 600; }
        .time-hint { font-size: 0.8rem; color: var(--accent-soft); text-align: center; margin-bottom: 40px; }

        .message-row { display: flex; align-items: flex-start; margin-bottom: 28px; opacity: 0; transform: translateY(15px); }
        .message-row.show { animation: slideInUp 0.6s forwards cubic-bezier(0.2, 0.8, 0.2, 1); }
        .message-row.me { flex-direction: row-reverse; }
        .message-row.history { opacity: 0.2 !important; filter: grayscale(80%); transform: scale(0.95); margin-bottom: 12px; }

        .avatar { width: 52px; height: 52px; border-radius: 50%; border: 2.5px solid white; box-shadow: 0 4px 12px var(--shadow); overflow: hidden; flex-shrink: 0; }
        .avatar img { width: 100%; height: 100%; object-fit: cover; }

        .bubble { max-width: 68%; padding: 13px 18px; margin: 0 12px; font-size: 0.95rem; line-height: 1.6; border-radius: 20px; background: white; box-shadow: 2px 4px 12px var(--shadow); border: 1px solid rgba(0,0,0,0.01); }
        .her .bubble { background: var(--her-bubble); border-top-left-radius: 4px; }
        .me .bubble { background: var(--me-bubble); border-top-right-radius: 4px; }

        .narrative { text-align: center; font-size: 0.82rem; color: #a1a1a1; margin: 30px 0; font-style: italic; opacity: 0; }
        .narrative.show { animation: fadeIn 1s forwards; }

        .os-btn-container { text-align: center; margin: 35px 0; opacity: 0; }
        .os-btn-container.show { animation: fadeIn 1s forwards; }
        .os-toggle-btn { background: white; border: 1.5px solid var(--os-border); padding: 9px 22px; border-radius: 25px; color: var(--accent-soft); font-size: 0.8rem; cursor: pointer; }
        .os-card { background: var(--os-bg); border: 1px solid var(--os-border); padding: 22px; border-radius: 14px; margin-top: 18px; display: none; text-align: left; animation: slideUp 0.5s forwards; }
        .os-card.visible { display: block; box-shadow: 0 0 15px rgba(255, 142, 142, 0.15); }
        .os-content { font-size: 0.9rem; line-height: 1.85; white-space: pre-wrap; position: relative; }

        .hidden-secret { position: absolute; background: #d15d5d; color: white; padding: 4px 8px; font-size: 0.75rem; border-radius: 4px; display: none; top: -30px; left: 20%; z-index: 100; box-shadow: 2px 2px 0 #4a2c10; }
        .can-touch { text-decoration: underline dotted var(--heart-red); cursor: help; position: relative; }

        .nav-footer { display: flex; justify-content: space-between; margin-top: 50px; padding-bottom: 40px; }
        .nav-btn { background: none; border: none; padding: 12px; cursor: pointer; color: var(--accent-soft); font-size: 0.85rem; }
        .final-letter { line-height: 2.3; font-size: 1rem; padding: 10px; white-space: pre-wrap; }

        .pixel-heart { position: fixed; width: 8px; height: 8px; background-color: var(--heart-red); pointer-events: none; z-index: 999; box-shadow: 2px 2px 0 #d15d5d; }

        @keyframes slideInUp { from { opacity: 0; transform: translateY(15px); } to { opacity: 1; transform: translateY(0); } }
        @keyframes slideUp { from { opacity: 0; transform: translateY(12px); } to { opacity: 1; transform: translateY(0); } }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        @keyframes heartFade { to { transform: translateY(-120px) rotate(45deg); opacity: 0; } }
    </style>
</head>
<body id="body">

<div id="transition-overlay"></div>

<audio id="bgm" loop>
    <source src="love.mp3" type="audio/mpeg">
    <source src="https://music.163.com/song/media/outer/url?id=1411558182.mp3" type="audio/mpeg">
</audio>

<div id="app">
    <div id="page-content"></div>
    
    <div class="nav-footer" id="nav-footer" style="display: none;">
        <button id="prev-btn" class="nav-btn" onclick="changePage(-1)">ä¸Šä¸€é¡µ</button>
        <button id="next-btn" class="nav-btn" onclick="changePage(1)">ä¸‹ä¸€é¡µ</button>
    </div>
</div>

<script>
    const storyData = [
        {
            type: "cover",
            title: "é‚£äº›æ²¡è¯´å‡ºå£çš„ OS",
            subtitle: "ä¸€ä¸ªæ™®é€šäººç±»çš„å¿ƒè·³è®°å½•"
        },
        {
            scene: "ğŸŒŸ åˆå§‹ç¯‡",
            time: "Day 1 Â· ç´«æ¯›æ˜Ÿäººé™ä¸´",
            type: "chat",
            dialogue: [
                { role: "her", text: "ä½ å¥½å‘€ï¼ˆè¡¨æƒ…åŒ…ï¼‰" },
                { role: "me", text: "hiiï¼Œä½ å¥½ï¼Œè€å¸ˆä½ å‘è‰²å¥½å¸ç›ï¼Œç°åœ¨è¿˜æ˜¯ç´«æ¯›å—" }
            ],
            os: `<b>å§æ§½ã€‚</b>
çƒŸç†å¦†ï¼å¤§çœ¼ç›ï¼å±Œå±Œçš„ï¼æˆ‘çš„èœï¼

æˆ‘æ€ä¹ˆä¸æ—©ç‚¹åˆ·é™„è¿‘çš„äººï¼Ÿ
è°¢è°¢è€å¤©çˆ·
ç¾å¥³ä¸»åŠ¨è·Ÿæˆ‘æ‰“æ‹›å‘¼ï¼Ÿï¼Ÿï¼Ÿ
ä¹Ÿæ˜¯å¥½èµ·æ¥äº†hhhhhh`
        },
        {
            scene: "ğŸŒŸ åˆå§‹ç¯‡",
            time: "ç¬¬ä¸€æ™š Â· å¼ºè£…å†·é™",
            type: "chat",
            dialogue: [
                { role: "her", text: "ä½ å¥½å‘€ï¼ˆè¡¨æƒ…åŒ…ï¼‰", isHistory: true },
                { role: "me", text: "hiiï¼Œä½ å¥½ï¼Œè€å¸ˆä½ å‘è‰²å¥½å¸ç›ï¼Œç°åœ¨è¿˜æ˜¯ç´«æ¯›å—", isHistory: true },
                { role: "info", text: "å¥¹å½“å¤©æ™šä¸Šæ²¡å›æˆ‘" }
            ],
            os: `ç¨³ä½ï¼Œ å¯èƒ½åœ¨å¿™ï¼Œäººå®¶ä¸å›ä¹Ÿæ­£å¸¸

ä½†æ˜¯ï¼Œ<b>ä¸èƒ½è®¿é—®å¥¹ä¸»é¡µå¤ªå¤šæ¬¡</b>
æœ‰è®¿å®¢è®°å½•

æˆ‘å°±...å½•ä¸ªå±å§
æˆ‘ä¸æ˜¯å˜æ€ã€æˆ‘ä¸æ˜¯å˜æ€ã€æˆ‘ä¸æ˜¯å˜æ€

å¥½ï¼Œè¿™æ˜¯æœ€åä¸€æ¬¡çœ‹å¥¹
çœŸçš„æœ€åä¸€æ¬¡
ï¼ˆäº”åˆ†é’Ÿåï¼šå†çœ‹ä¸€æ¬¡`
        },
        {
            scene: "ğŸŒŸ åˆå§‹ç¯‡",
            time: "ç¬¬ä¸€å¤©æ²¡å›",
            type: "chat",
            dialogue: [
                { role: "me", text: "hiiï¼Œä½ å¥½ï¼Œè€å¸ˆä½ å‘è‰²å¥½å¸ç›ï¼Œç°åœ¨è¿˜æ˜¯ç´«æ¯›å—", isHistory: true },
                { role: "info", text: "å¯¹è¯æ¡†ä¸€ç‰‡å®‰é™..." }
            ],
            os: `ï¼Ÿï¼Ÿ
æ˜¯åœ¨å¿™å§ï¼Ÿ
è¿˜æ˜¯è¯¯è§¦è·Ÿæˆ‘èŠå¤©ï¼Ÿ

è¿˜æ˜¯å¹¿æ’’ç½‘ï¼Ÿï¼Ÿ
ä¸‰åˆ†é’Ÿçƒ­åº¦çš„æ‹‰æ‹‰ï¼Ÿï¼Ÿ

è®¨åŒä½ 
ï¼ˆä½†æˆ‘è¿˜æ˜¯åœ¨ç­‰`
        },
        {
            scene: "ğŸŒŸ åˆå§‹ç¯‡",
            time: "ç¬¬äºŒå¤©æ²¡å›",
            type: "chat",
            dialogue: [{ role: "info", text: "ä¾ç„¶æ²¡æœ‰æ¶ˆæ¯" }],
            os: `å“¼
æˆ‘ä¸Šè¿™ä¸ªè½¯ä»¶åˆä¸æ˜¯ä¸ºäº†çœ‹å¥¹

æˆ‘æ˜¯æ¥çœ‹æœ‰æ²¡æœ‰åˆ«äººè·Ÿæˆ‘æ‰“æ‹›å‘¼

â€¦â€¦
ï¼ˆæ‰“å¼€è½¯ä»¶ç¬¬ä¸€ä»¶äº‹è¿˜æ˜¯çœ‹çœ‹æœ‰æ²¡æœ‰å¥¹çš„æœªè¯»æ¶ˆæ¯

æ²¡ç¼˜åˆ†å°±æ²¡ç¼˜åˆ†å§

è¯´ä¸å®šå¥¹åªæ˜¯å¶å°”ä¸Šæ¥çœ‹çœ‹çš„ä¾„å¥³
é™ªè€å…¬å°å­©å»äº†
å¯¹ï¼ä¸€å®šæ˜¯è¿™æ ·

ï¼ˆå¼€å§‹è‡ªæˆ‘å®‰æ…°æ–‡å­¦åˆ›ä½œ`
        },
        {
            scene: "ğŸŒŸ åˆå§‹ç¯‡",
            time: "ç¬¬ä¸‰å¤© Â· å¥‡è¿¹å‘ç”Ÿ",
            type: "chat",
            dialogue: [
                { role: "her", text: "å“ˆå“ˆhiiï¼Œæˆ‘æ²¡æ‰“å¼€è¿™ä¸ªéƒ½æ²¡çœ‹åˆ°" },
                { role: "her", text: "æˆ‘æ˜¯ç´«æ¯›æ˜Ÿäºº" }
            ],
            os: `å•Šå•Šå•Šå•Šå•Šå•Šå•Š<b>å¥¹å›æˆ‘è¾£ï¼ï¼ï¼ï¼</b>

æˆ‘ä¸æ˜¯ä¸€æ¬¡æ€§èŠå¤©äººï¼ï¼ï¼
å¤©æ— ç»äººä¹‹è·¯ï¼ï¼

ç­‰ç­‰...
æ€ä¹ˆéš”äº†1000+å…¬é‡Œï¼Ÿï¼Ÿ
ä¹‹å‰ä¸æ˜¯åœ¨å¹¿å·å—

ç®—äº†ï¼Œå…ˆèŠ
æ¯•ç«Ÿè¿™ä¹ˆå¯¹æˆ‘çœ¼ç¼˜`
        },
        {
            scene: "ğŸ“ ç”µè¯ç¯‡",
            transitionText: "ä¸€å‘¨å Â· ç”µè¯é‡Œçš„å£°éŸ³",
            time: "æˆ‘æƒ³å¬å¥¹å£°éŸ³",
            type: "chat",
            dialogue: [
                { role: "info", text: "è®¤è¯†ä¸€ä¸ªæ˜ŸæœŸäº†ã€‚æ¯å¤©èŠåˆ°ä¸‰å››ç‚¹ã€‚" },
                { role: "her", text: "è€å¸ˆï¼Œæˆ‘è¿˜è·Ÿç”·çš„ç›¸è¿‡äº²ä½ çŸ¥é“ä¸ï¼Œå˜¿å˜¿ï¼Œä½ ä¸çŸ¥é“" },
                { role: "me", text: "ï¼Ÿå•¥æ—¶å€™" },
                { role: "her", text: "ä½ å¾—è·Ÿæˆ‘å¤šè¯´è¯æˆ‘æ‰å‘Šè¯‰ä½ " }
            ],
            os: `æœºä¼šæ¥äº†

å¤šè¯´è¯ï¼Ÿ
æˆ‘åˆç†ç†è§£ä¸ºç­‰äº<b>å¤šæ‰“ç”µè¯</b>æ²¡æ¯›ç—…å§

å¥¹æ¥äº†å°±æ˜¯å¥¹çš„é€‰æ‹©
ä¸æ˜¯æˆ‘å¤ªä¸»åŠ¨
é€»è¾‘å®Œç¾

ï¼ˆæ‰‹å·²ç»æŒ‰ä¸‹é€šè¯é”®`
        },
        {
            scene: "ğŸ“ ç”µè¯ç¯‡",
            time: "ç¬¬ä¸€æ¬¡é€šè¯åçš„æ—©æ™¨",
            type: "chat",
            dialogue: [
                { role: "her", text: "ä½ é†’äº†15åˆ†é’Ÿæ€ä¹ˆä¸ç»™æˆ‘å‘æ¶ˆæ¯" },
                { role: "me", text: "æ€•åµåˆ°ä½ å˜›" }
            ],
            os: `å¥¹åœ¨æ„æˆ‘é†’æ²¡é†’ï¼Ÿï¼Ÿï¼Ÿ
<b>çˆ½æ­»æˆ‘äº†ã€‚</b>
å¥¹å±…ç„¶å±…ç„¶å±…ç„¶åœ¨æ„

è€Œä¸”
å¥¹åˆšç¡é†’çš„å£°éŸ³æ€ä¹ˆè¿™ä¹ˆå¯çˆ±ï¼Ÿï¼Ÿ
æˆ‘èƒ½ä¸èƒ½å†å¬ä¸€é`
        },
        {
            scene: "âœˆï¸ è§é¢ç¯‡",
            transitionText: "å¹¿å· Â· æ™´ Â· æ¥æœºå£",
            time: "æ¥æœº Â· å‡è£…é•‡å®šçš„å°åºŸç‰©",
            type: "chat",
            dialogue: [{ role: "info", text: "åœ¨æ¥æœºå£ä¹°å’–å•¡ï¼Œæ‰¾ä¸ªä½ç½®åï¼Œå¼ºè¡Œåˆ·æ‰‹æœºã€‚" }],
            os: `å¥¹è½åœ°äº†
å•Šå•Šå•Šå•Šå•Š

ä¸æ€¥ä¸æ€¥
å¥¹è¿˜è¦å–è¡Œæ

ï¼ˆæ‰‹æœºéœ‡åŠ¨ï¼‰
å¥¹ï¼šæˆ‘å–è¡Œæäº†
ï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿ

è¿™ä¹ˆå¿«çš„å—ï¼Ÿï¼Ÿ
åˆšåˆšä¸æ˜¯è¿˜åœ¨æ»‘è¡Œï¼Ÿï¼Ÿ
å¥¹æ€ä¹ˆç›´æ¥é—ªç°ï¼Ÿï¼Ÿ

æˆ‘è¿˜æ²¡å‡†å¤‡å¥½å•Šå•Šå•Š`
        },
        {
            scene: "âœˆï¸ è§é¢ç¯‡",
            time: "ç¤¾æ­»ç°åœº",
            type: "chat",
            dialogue: [
                { role: "info", text: "ç»ˆäºï¼Œé‚£ä¸ªæ˜¾çœ¼çš„ç´«æ¯›å‡ºç°äº†..." },
                { role: "info", text: "å¥¹ç›¯ç€æˆ‘çœ‹ï¼Œè€Œæˆ‘ä¸æ•¢æŠ¬å¤´" }
            ],
            os: `......
å¥¹æ¥äº†
æ¯”æˆ‘æƒ³è±¡æ›´æœ‰æ°”åœºä¸€ç‚¹
ç¡®å®åƒå§

å¥¹ç›¯ç€æˆ‘çœ‹
æˆ‘ä¸æ•¢æŠ¬å¤´
æˆ‘æ€ä¹ˆè¿™ä¹ˆæ€‚å•Š

æˆ‘çš„å½¢è±¡<b>å…¨æ²¡äº†</b>`
        },
        {
            scene: "ğŸ  æ—¥å¸¸ç¯‡",
            transitionText: "æˆéƒ½ Â· é˜´ Â· å®¶é‡Œ",
            time: "è‡­å±äº‹ä»¶",
            type: "chat",
            dialogue: [
                { role: "info", text: "å¥¹åœ¨æ¤…å­ä¸ŠæŒªäº†ä¸€ä¸‹ã€‚å™—å™—ã€‚" },
                { role: "me", text: "å®å®ï¼Œæˆ‘ä»¬çš„å…³ç³»å·²ç»è¿™ä¹ˆäº²å¯†äº†å—ï¼Ÿ" },
                { role: "her", text: "å“å‘€æˆ‘å¿ä¸ä½å˜›ï¼Œä½ å«Œå¼ƒæˆ‘ï¼Ÿï¼" },
                { role: "me", text: "å¯æ˜¯å¤ªè‡­äº†ï¼ˆå‡è£…é€ƒè·‘ï¼‰" }
            ],
            os: `è¿™çŒªçœ‹èµ·æ¥å¹²å¹²å‡€å‡€çš„
<span class="can-touch" onmouseover="showSecret(true)" onmouseout="showSecret(false)">å±æ€ä¹ˆè¿™ä¹ˆè‡­<span id="secret-pop" class="hidden-secret">ï¼ˆå…¶å®è‡­æˆ‘ä¹Ÿå–œæ¬¢ï¼Œå˜¿å˜¿ï¼‰</span></span>ã€‚

ä¸è¿‡æˆ‘åˆšåˆšè·‘å»å«ç”Ÿé—´
æ˜¯ä¸æ˜¯æˆåŠŸé€—å¥¹ç¬‘äº†ï¼Ÿ

å¥¹ç¬‘èµ·æ¥å¥½å¯çˆ±

ç®—äº†
è‡­å°±è‡­å§`
        },
        {
            scene: "ğŸ  æ—¥å¸¸ç¯‡",
            time: "æ¸…æ™¨çš„å®å®çŒª",
            type: "chat",
            dialogue: [{ role: "info", text: "å¥¹è¿˜åœ¨ç¡ Zzzzz" }],
            os: `æˆ‘çš„å®å®çŒª
ç¡è§‰æ€ä¹ˆä¹Ÿè¿™ä¹ˆå¯çˆ±

<b>ç«æ¯›å¥½é•¿
çš®è‚¤å¥½ç™½</b>

å¦‚æœæ¯å¤©é†’æ¥éƒ½èƒ½çœ‹åˆ°å¥¹å°±å¥½äº†
æˆ‘è¦å¥½å¥½çæƒœ
æ¥ä¸‹æ¥è¿˜èƒ½åœ¨ä¸€èµ·çš„æ—¶é—´ã€‚`
        },
        {
            scene: "ğŸ  æ—¥å¸¸ç¯‡",
            time: "å°æƒŠå–œè®¡åˆ’",
            type: "chat",
            dialogue: [{ role: "info", text: "æ˜å¤©ç¦»å¼€æˆéƒ½ï¼Œæ‚„æ‚„å‡†å¤‡æƒŠå–œã€‚" }],
            os: `è¿™å®¶ä¼™è€è¯´æˆ‘è¡¨ç™½çš„æ—¶å€™ä¸è®¤çœŸ
é‚£å°±è¡¥ä¸€ä¸ªè®¤çœŸçš„è¡¨ç™½

æ”¾æ•å¤´åº•ä¸‹
è®©å¥¹è‡ªå·±æ‘¸åˆ°

èŠ±è¦å¯¹çŒ«æ— å®³
èœ¡çƒ›è¦ä¸ä¸‘

å†ä¹°ä¸ªæ³¡è„šç›†
<b>å¥¹æ‰‹è„šå†°å‡‰</b>
è¿™æ ·å¥¹ä»¥åä¸€ä¸ªäººåœ¨å®¶ä¹Ÿèƒ½æ³¡

å®Œç¾å®Œç¾`
        },
        {
            scene: "ğŸŒ… ç»“å°¾",
            time: "To my Babe",
            type: "final",
            content: `å®å®ï¼š
æœ€å¼€å§‹é‚£ä¸‰å¤©é‡Œ
æˆ‘å·²ç»åœ¨è„‘å­é‡Œæ¼”å®Œäº†å¾ˆå¤šç§ç»“å±€

æœ‰ä½ ä¸å†å›æˆ‘
æœ‰æˆ‘åˆ æ‰è½¯ä»¶
è¿˜æœ‰æ²¡ç¼˜åˆ†å°±ç®—äº†

ä½†å¥½åœ¨ä½ å›æˆ‘äº†

åæ¥ç”µè¯é‚£è¾¹çš„å£°éŸ³
æœºåœºé‡Œèµ°å‡ºæ¥çš„ç´«è‰²å¤´å‘
æ²™å‘ä¸Šè®¤çœŸè£…ä½œæ²¡äº‹å‘ç”Ÿçš„æ ·å­
éƒ½æ…¢æ…¢å˜æˆäº†æˆ‘ä»¬

è™½ç„¶é‚£å¤©æ²¡æœ‰ç‚¹å¤ªå¤šæ¬¡ä½ çš„ä¸»é¡µ
ä½†ç°åœ¨
æˆ‘å¯ä»¥å…‰æ˜æ­£å¤§åœ°çœ‹ç€ä½ 

<b>æƒ…äººèŠ‚å¿«ä¹ é™ˆé™ˆ</b>`
        }
    ];

    let currentIndex = 0;
    const audio = document.getElementById('bgm');
    const overlay = document.getElementById('transition-overlay');

    const hour = new Date().getHours();
    if (hour >= 23 || hour < 5) document.getElementById('body').classList.add('dark-mode');

    document.addEventListener('click', (e) => {
        if(audio.paused) audio.play();
        for(let i=0; i<3; i++) {
            const heart = document.createElement('div');
            heart.className = 'pixel-heart';
            heart.style.left = e.clientX + (Math.random()*30-15) + 'px';
            heart.style.top = e.clientY + 'px';
            heart.style.animation = `heartFade ${0.6 + Math.random()*0.5}s forwards`;
            document.body.appendChild(heart);
            setTimeout(() => heart.remove(), 1000);
        }
    });

    function showSecret(show) {
        const pop = document.getElementById('secret-pop');
        if(pop) pop.style.display = show ? 'block' : 'none';
    }

    async function render(skipTransition = false) {
        const data = storyData[currentIndex];
        const pageContainer = document.getElementById('page-content');
        const nav = document.getElementById('nav-footer');
        
        // åœºæ™¯è½¬åœºé€»è¾‘
        if (!skipTransition && data.transitionText) {
            overlay.innerText = data.transitionText;
            overlay.style.display = 'flex';
            overlay.style.opacity = 0;
            let op = 0;
            const fadeIn = setInterval(() => { op += 0.1; overlay.style.opacity = op; if(op >= 1) clearInterval(fadeIn); }, 50);
            await new Promise(r => setTimeout(r, 1200));
            const fadeOut = setInterval(() => { op -= 0.1; overlay.style.opacity = op; if(op <= 0) { clearInterval(fadeOut); overlay.style.display = 'none'; } }, 50);
        }

        pageContainer.innerHTML = '';

        if (data.type === "cover") {
            nav.style.display = 'none';
            pageContainer.innerHTML = `
                <div id="cover-page">
                    <div class="pixel-mail"></div>
                    <div class="cover-title">${data.title}</div>
                    <div class="cover-subtitle">${data.subtitle}</div>
                    <button class="start-btn" onclick="changePage(1)">ç¿»å¼€æ•…äº‹</button>
                </div>`;
        } else {
            nav.style.display = 'flex';
            // æ˜¾ç¤ºå¤´éƒ¨å…ƒä¿¡æ¯å’Œè¿›åº¦æ¡
            let html = `
                <div class="header-meta">
                    <span>${data.scene ? data.scene.split('ï½œ')[0] : ''}</span>
                    <span>${String(currentIndex).padStart(2, '0')} / ${storyData.length - 1}</span>
                </div>
                <div class="progress-bar-wrap"><div id="progress-inner" style="width: ${(currentIndex / (storyData.length-1)) * 100}%"></div></div>`;
            
            if (data.type === 'chat') {
                html += `<div class="scene-title">${data.scene}</div><div class="time-hint">${data.time}</div>`;
                data.dialogue.forEach((item, index) => {
                    if (item.role === 'info') html += `<div class="narrative" id="item-${index}">${item.text}</div>`;
                    else {
                        const avatarImg = item.role === 'her' ? 'her.jpg' : 'me.jpg';
                        const fallbackImg = item.role === 'her' ? 'https://api.dicebear.com/7.x/pixel-art/svg?seed=Felix' : 'https://api.dicebear.com/7.x/pixel-art/svg?seed=Aneka';
                        const historyClass = item.isHistory ? 'history' : '';
                        html += `<div class="message-row ${item.role} ${historyClass}" id="item-${index}">
                                    <div class="avatar"><img src="${avatarImg}" onerror="this.src='${fallbackImg}'"></div>
                                    <div class="bubble">${item.text}</div>
                                 </div>`;
                    }
                });
                html += `<div class="os-btn-container" id="os-btn-wrap">
                            <button class="os-toggle-btn" onclick="toggleOS()">æŸ¥çœ‹æˆ‘çš„å†…å¿ƒ OS</button>
                            <div id="os-card" class="os-card"><span class="os-label">ğŸ§  å†…å¿ƒå®å½•</span><div class="os-content">${data.os}</div></div>
                         </div>`;
                pageContainer.innerHTML = html;

                // æ‰“å­—æœºé¡ºæ¬¡æ˜¾ç¤º
                data.dialogue.forEach((_, index) => {
                    setTimeout(() => { const el = document.getElementById(`item-${index}`); if(el) el.classList.add('show'); }, index * 400);
                });
                setTimeout(() => { const el = document.getElementById('os-btn-wrap'); if(el) el.classList.add('show'); }, data.dialogue.length * 400);

            } else {
                // ç»“å°¾é¡µé€»è¾‘
                html += `<div class="scene-title">${data.scene}</div><div class="time-hint">${data.time}</div><div class="final-letter">${data.content}</div>`;
                pageContainer.innerHTML = html;
                // ç‰¹æ®Šå¯¼èˆªï¼šæƒ…ä¹¦é¡µåªä¿ç•™â€œå›åˆ°å°é¢â€
                nav.innerHTML = `<button class="nav-btn" style="margin: 0 auto;" onclick="goHome()">å›åˆ°å°é¢</button>`;
            }
        }

        if(currentIndex !== storyData.length - 1) {
            document.getElementById('nav-footer').innerHTML = `
                <button id="prev-btn" class="nav-btn" onclick="changePage(-1)">ä¸Šä¸€é¡µ</button>
                <button id="next-btn" class="nav-btn" onclick="changePage(1)">ä¸‹ä¸€é¡µ</button>`;
            document.getElementById('prev-btn').disabled = currentIndex <= 1;
        }
        
        window.scrollTo({ top: 0, behavior: 'smooth' });
    }

    function toggleOS() {
        const card = document.getElementById('os-card');
        const isVisible = card.classList.toggle('visible');
        document.querySelector('.os-toggle-btn').innerText = isVisible ? 'æ”¶èµ·å†…å¿ƒå®å½•' : 'æŸ¥çœ‹æˆ‘çš„å†…å¿ƒ OS';
    }

    function changePage(step) { currentIndex += step; render(); }
    function goHome() { currentIndex = 0; render(true); }
    
    render(true);
</script>

</body>
</html>


